name: voxd-plus
arch: ${ARCH}
version: ${VERSION}
release: "1"
section: utils
priority: optional
license: MIT
maintainer: "Ryan Doiron <rdoiron@gmail.com>"
homepage: "https://github.com/rdoiron/voxd-plus"
description: "VOXD-Plus - enhanced voice typing on Linux (CLI/GUI/Tray/Flux)"
vendor: "VOXD-Plus"
conflicts:
  - voxd
replaces:
  - voxd

contents:
  # Only ship the runtime sources under /opt/voxd-plus/src (paths relative to repo root)
  - src: ./src
    dst: /opt/voxd-plus/src

  # Ship pyproject.toml so runtime can read version when metadata/git are absent
  - src: pyproject.toml
    dst: /opt/voxd-plus/pyproject.toml
    file_info:
      mode: 0644

  - src: packaging/voxd-plus.wrapper
    dst: /usr/bin/voxd-plus
    file_info:
      mode: 0755

  - src: packaging/99-uinput.rules
    dst: /etc/udev/rules.d/99-uinput.rules
    file_info:
      mode: 0644

  - src: packaging/ydotoold.service
    dst: /usr/lib/systemd/user/ydotoold.service
    file_info:
      mode: 0644

  - src: packaging/voxd-plus-tray.service
    dst: /usr/lib/systemd/user/voxd-plus-tray.service
    file_info:
      mode: 0644

  - src: packaging/voxd-plus-ydotoold
    dst: /usr/bin/voxd-plus-ydotoold
    file_info:
      mode: 0755

overrides:
  deb:
    depends:
      - ffmpeg
      - cmake
      - curl
      - xclip
      - xsel
      - wl-clipboard
      - xdotool
      - python3-platformdirs
      - python3-venv
      - libportaudio2
      - python3-numpy
      - python3-requests
      - python3-yaml
      - python3-psutil
      - python3-pyperclip
      - python3-tqdm
      - python3-pyqt6
      - python3-pyqtgraph
      # python3-sounddevice not available on all Ubuntu versions; install via venv in postinstall
    recommends:
      - ydotool
      - pavucontrol
      - alsa-plugins
      - pulseaudio | pipewire-pulse
  rpm:
    depends:
      - cmake
      - curl
      - xclip
      - xsel
      - wl-clipboard
      - xdotool
      - python3-platformdirs
      - python3-virtualenv
      - portaudio
      - python3-numpy
      - python3-requests
      - python3-PyYAML
      - python3-psutil
      - python3-pyperclip
      - python3-tqdm
      # sounddevice installed via venv in postinstall
      # Note: On Fedora the ffmpeg package may require enabling RPM Fusion repository.
      # Note: On openSUSE the ffmpeg package (and other codecs) often come via the Packman repository.
    suggests:
      - ydotool
      - ffmpeg
      - python3-qt6
      - python3-pyqtgraph
      - pavucontrol
      # Fedora
      - alsa-plugins-pipewire
      - pipewire-pulseaudio
      # openSUSE
      - alsa-plugins-pulse
  archlinux:
    depends:
      - ffmpeg
      - cmake
      - curl
      - xclip
      - xsel
      - wl-clipboard
      - xdotool
      - python-platformdirs
      - python-virtualenv
      - portaudio
      - python-numpy
      - python-requests
      - python-yaml
      - python-psutil
      - python-pyperclip
      - python-tqdm
      - python-pyqt6
      - python-pyqtgraph

scripts:
  postinstall: packaging/postinstall.sh
  postremove: packaging/postremove.sh
